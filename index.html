<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ENGLISH WITH AI BAYAN ‚Äì Beginner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root{
      --blue-main:#005b73;
      --blue-soft:#008a9e;
      --gold:#ffd54f;
      --bg:#f3f7fa;
      --topicColor:#005b73;
    }

    *{
      box-sizing:border-box;
      margin:0;
      padding:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }

    body{
      background:var(--bg);
      color:#043042;
    }

    /* HEADER WITH GIRL LOGO */
    header{
      background:linear-gradient(90deg,#005b73,#008a9e);
      color:#fff;
      padding:10px 24px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      box-shadow:0 2px 6px rgba(0,0,0,.2);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .logo-img{
      width:50px;
      height:50px;
      border-radius:50%;
      object-fit:cover;
      border:3px solid var(--gold);
      background:white;
    }

    .brand-text h1{
      font-size:18px;
      letter-spacing:.04em;
    }

    .brand-text span{
      font-size:12px;
      opacity:.9;
    }

    .top-info{
      font-size:13px;
      text-align:right;
    }
    .top-info strong{color:var(--gold);}

    main{
      padding:16px;
      max-width:1300px;
      margin:0 auto;
    }

    .card{
      background:#fff;
      border-radius:14px;
      box-shadow:0 4px 14px rgba(0,0,0,.08);
      padding:20px;
    }

    .hidden{display:none !important;}

    .section-title{
      font-size:18px;
      margin-bottom:10px;
      font-weight:600;
    }
    .muted{
      color:#607080;
      font-size:12px;
    }

    .field-label{
      font-size:14px;
      margin-bottom:4px;
    }

    .text-input{
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #c9d5df;
      margin-bottom:14px;
      font-size:14px;
    }
    .text-input:focus{
      outline:none;
      border-color:var(--blue-soft);
      box-shadow:0 0 0 2px rgba(0,138,158,.2);
    }

    .btn{
      border:none;
      border-radius:10px;
      padding:10px 18px;
      font-size:14px;
      font-weight:600;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
    }
    .btn-primary{
      background:var(--blue-soft);
      color:#fff;
    }
    .btn-primary:hover{background:#007487;}
    .btn-ghost{
      background:#eef5f9;
      color:var(--blue-main);
    }
    .btn-ghost:hover{background:#dde9f1;}

    .login-note{
      font-size:12px;
      color:#526675;
      margin-top:10px;
      line-height:1.4;
    }

    .error{
      margin-top:10px;
      color:#b00020;
      font-size:13px;
    }

    /* SCREENS */
    #loginScreen{
      max-width:520px;
      margin:40px auto;
    }

    #mainMenuScreen{
      display:grid;
      grid-template-columns:2fr 1.2fr;
      gap:16px;
    }
    @media(max-width:960px){
      #mainMenuScreen{
        grid-template-columns:1fr;
      }
    }

    .tag{
      display:inline-block;
      padding:2px 6px;
      border-radius:999px;
      background:#e3f2fd;
      font-size:11px;
      color:#005b73;
    }

    .top-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:12px;
    }

    .stars-badge{
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:4px 8px;
      border-radius:999px;
      background:#fff9e5;
      border:1px solid #ffe082;
      font-size:12px;
    }
    .star-icon{color:#ffb300;}

    .topics-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:8px;
    }
    @media(max-width:700px){
      .topics-grid{grid-template-columns:1fr;}
    }

    .topic-card{
      border-radius:12px;
      border:1px solid #dde5ee;
      padding:10px 12px;
      background:#f8fafc;
      cursor:pointer;
      transition:.15s;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .topic-card:hover{
      background:#e3f2fd;
      transform:translateY(-1px);
    }
    .topic-card-title{
      font-size:14px;
      font-weight:600;
    }
    .topic-card-sub{
      font-size:11px;
      color:#607080;
    }

    /* AI PANEL (–ø–æ–∫–∞ –¥–µ–º–æ, –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ò–ò) */
    #aiPanel{
      background:#fff;
      border-radius:14px;
      padding:14px;
      box-shadow:0 2px 10px rgba(0,0,0,.06);
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:260px;
    }
    #aiPanel h3{
      font-size:15px;
      margin-bottom:4px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
    }
    #aiLimit{
      font-size:11px;
    }
    .chat-note{
      font-size:11px;
      color:#607080;
    }
    .chat-box{
      flex:1;
      border-radius:10px;
      border:1px solid #dde5ee;
      padding:8px;
      background:#f8fafc;
      font-size:13px;
      overflow-y:auto;
    }
    .chat-msg{
      margin-bottom:6px;
      line-height:1.4;
    }
    .chat-msg strong{color:#005b73;}
    #aiQuestion{
      width:100%;
      min-height:60px;
      resize:vertical;
      border-radius:10px;
      border:1px solid #c9d5df;
      padding:8px;
      font-size:13px;
      margin-top:4px;
    }
    #aiQuestion:focus{
      outline:none;
      border-color:var(--blue-soft);
      box-shadow:0 0 0 2px rgba(0,138,158,.17);
    }
    .chat-actions{
      display:flex;
      justify-content:flex-end;
      margin-top:4px;
    }

    /* TOPIC SCREEN */

    #topicScreen{
      max-width:1000px;
      margin:0 auto;
    }
    .topic-header{
      border-radius:16px 16px 0 0;
      padding:14px 16px;
      background:linear-gradient(90deg,var(--topicColor),#007d99);
      color:#fff;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .topic-header-main{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .topic-header-title{
      font-size:18px;
      font-weight:600;
    }
    .topic-header-tag{
      font-size:11px;
      opacity:.9;
    }
    .topic-header-buttons{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
    }
    .btn-topic{
      border:none;
      border-radius:999px;
      padding:6px 12px;
      font-size:12px;
      cursor:pointer;
      font-weight:600;
    }
    .btn-topic.back{
      background:#ffffff;
      color:var(--topicColor);
    }
    .btn-topic.menu{
      background:rgba(255,255,255,.15);
      color:#fff;
      border:1px solid rgba(255,255,255,.5);
    }

    .topic-body{
      background:#fff;
      border-radius:0 0 16px 16px;
      box-shadow:0 4px 14px rgba(0,0,0,.08);
      padding:16px;
    }

    .grammar-box{
      background:#f7fbff;
      border-left:4px solid var(--topicColor);
      padding:10px 12px;
      border-radius:10px;
      margin-bottom:12px;
      font-size:14px;
      line-height:1.5;
    }
    .grammar-box strong{color:#005b73;}
    .formula{
      font-family:"Consolas","Courier New",monospace;
      background:#e3f2fd;
      padding:3px 6px;
      border-radius:6px;
      margin-right:4px;
      display:inline-block;
      margin-top:4px;
    }
    .examples{
      margin-top:8px;
      font-size:13px;
    }
    .examples li{
      margin-left:18px;
      margin-bottom:2px;
    }
    .grammar-ru{
      margin-top:10px;
      font-size:13px;
      color:#24313f;
    }

    .exercises{
      margin-top:12px;
    }
    .exercise-block{
      border-radius:12px;
      background:#f8fafc;
      padding:10px 12px;
      margin-bottom:10px;
      border:1px solid #dde5ee;
    }
    .exercise-title{
      font-size:14px;
      font-weight:600;
      margin-bottom:6px;
    }
    .question-row{
      font-size:13px;
      margin-bottom:6px;
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      gap:6px;
    }
    .question-text{
      flex:1 1 160px;
    }
    .options{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      align-items:center;
    }
    .options label{
      background:#ffffff;
      border-radius:999px;
      border:1px solid #ccd7e3;
      padding:2px 8px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:3px;
    }
    .options input[type="radio"]{
      accent-color:var(--topicColor);
    }
    .mark{
      width:18px;
      text-align:center;
      font-size:16px;
      font-weight:700;
    }
    .mark.correct{color:#2e7d32;}
    .mark.wrong{color:#c62828;}
    .exercise-footer{
      margin-top:6px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
    }
    .exercise-footer small{
      font-size:11px;
      color:#607080;
    }

    /* TEACHER */

    #teacherScreen{
      margin-top:20px;
    }
    .top-buttons{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-bottom:8px;
    }
    .table-wrapper{
      overflow-x:auto;
    }
    table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
      margin-top:10px;
    }
    th,td{
      border:1px solid #dde5ee;
      padding:6px 8px;
      text-align:left;
      white-space:nowrap;
    }
    th{
      background:#eef5f9;
      font-weight:600;
    }

    /* –ü–ï–ß–ê–¢–¨: —Ç–æ–ª—å–∫–æ —Ç–µ–º–∞ */
    @media print{
      header, #loginScreen, #mainMenuScreen, #teacherScreen{
        display:none !important;
      }
      body{
        background:#fff;
      }
      #topicScreen{
        display:block !important;
        margin:0;
        padding:0;
      }
      .topic-body{
        box-shadow:none;
        border-radius:0;
      }
    }
  </style>
</head>
<body>
<header>
  <div class="brand">
    <img src="logo.png" alt="AI Bayan" class="logo-img">
    <div class="brand-text">
      <h1>ENGLISH WITH AI BAYAN</h1>
      <span>Beginner ¬∑ stars ¬∑ interactive topics</span>
    </div>
  </div>
  <div class="top-info" id="topInfo">Not logged in</div>
</header>

<main>
  <!-- LOGIN -->
  <section id="loginScreen" class="card">
    <h2 class="section-title">Login</h2>
    <p class="muted" style="margin-bottom:10px">
      Enter your <strong>Name</strong> and <strong>Code</strong>. Ask your teacher for the code.
    </p>

    <label class="field-label" for="loginName">Name</label>
    <input id="loginName" class="text-input" type="text"
           placeholder="Your name" />

    <label class="field-label" for="loginCode">Code</label>
    <input id="loginCode" class="text-input" type="password"
           placeholder="Student or teacher code" />

    <div style="display:flex;gap:8px;margin-top:4px">
      <button class="btn btn-primary" onclick="handleLogin()">Login</button>
      <button class="btn btn-ghost" onclick="backToLogin()">Reset</button>
    </div>

    <div id="loginError" class="error hidden"></div>
  </section>
    <!-- MAIN MENU (STUDENT) -->
  <section id="mainMenuScreen" class="hidden">
    <section class="card">
      <div class="top-row">
        <div>
          <h2 class="section-title" style="margin-bottom:4px;">Beginner topics</h2>
          <div id="menuInfo" class="muted"></div>
        </div>
        <div>
          <span class="stars-badge">
            <span class="star-icon">‚≠ê</span>
            Stars: <span id="menuStars">0</span>
          </span>
        </div>
      </div>

      <div class="topics-grid" id="menuTopics"></div>
    </section>

    <aside id="aiPanel">
      <div>
        <h3>
          AI Bayan
          <span id="aiLimit"></span>
        </h3>
        <p class="chat-note">
          Demo mode. AI chat will be added later.
        </p>
      </div>

      <div id="chatBox" class="chat-box"></div>

      <div>
        <textarea id="aiQuestion"
                  placeholder="AI chat will be available soon." disabled></textarea>
        <div class="chat-actions">
          <button class="btn btn-primary" id="askBtn" disabled>Ask (soon)</button>
        </div>
        <p class="chat-note">
          Your questions will be visible for the teacher in the future version.
        </p>
      </div>
    </aside>
  </section>

  <!-- TOPIC SCREEN -->
  <section id="topicScreen" class="hidden">
    <div class="topic-header">
      <div class="topic-header-main">
        <div class="topic-header-title" id="topicHeaderTitle">Topic</div>
        <div class="topic-header-tag" id="topicHeaderTag"></div>
      </div>
      <div class="topic-header-buttons">
        <button class="btn-topic back" onclick="backToMenu()">‚Üê Back</button>
        <button class="btn-topic menu" onclick="backToMenu()">üè† Main menu</button>
        <button class="btn-topic menu" onclick="printCurrentTopic()">üñ® Print</button>
      </div>
    </div>
    <div class="topic-body">
      <div id="topicRuleContainer"></div>
      <div id="topicExercisesContainer"></div>
    </div>
  </section>

  <!-- TEACHER -->
  <section id="teacherScreen" class="hidden card">
    <div class="top-buttons">
      <button class="btn btn-ghost" onclick="backToLogin()">‚Üê Back to login</button>
      <span class="tag">Teacher mode</span>
    </div>
    <h2 class="section-title">Teacher dashboard</h2>
    <p class="muted">
      Shows data saved in this browser: stars and last login (per code).
    </p>

    <div class="table-wrapper">
      <table id="teacherTable">
        <thead>
        <tr>
          <th>Class</th>
          <th>Code</th>
          <th>Name</th>
          <th>Stars</th>
          <th>Last login</th>
        </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>
</main>
  <script>
/* ---------- CLASS RANGES (PIN) ---------- */

const classRanges = [
  { cls: "3E",  from: 101,  to: 115 },
  { cls: "4G",  from: 201,  to: 215 },
  { cls: "5G",  from: 301,  to: 315 },
  { cls: "5Zh", from: 401,  to: 415 },
  { cls: "6G",  from: 501,  to: 515 },
  { cls: "7B",  from: 601,  to: 615 },
  { cls: "7V",  from: 701,  to: 715 },
  { cls: "8E",  from: 801,  to: 815 },
  { cls: "9Zh", from: 901,  to: 915 },
  { cls: "10A", from: 1001, to: 1015 }
];

function getClassByCode(num){
  for (const r of classRanges){
    if (num >= r.from && num <= r.to){
      return r.cls;
    }
  }
  return null;
}
/* ---------- TOPIC COLORS ---------- */

const topicColors = {
  1:  "#FF7A00",
  2:  "#FF2400",
  3:  "#2ECC71",
  4:  "#FF00A8",
  5:  "#007BFF",
  6:  "#FFD500",
  7:  "#006D77",
  8:  "#800020",
  9:  "#C7F000",
  10: "#9D4EDD",
  11: "#FF6F61",
  12: "#009B77",
  13: "#E2725B",
  14: "#EEC9D2",
  15: "#4A4A4A",
  16: "#4C5866",
  17: "#0A5C5A",
  18: "#8E4585",
  19: "#0B6623",
  20: "#B22222"
};
    
    
/* ---------- TOPICS DATA (1‚Äì7 –∑–∞–ø–æ–ª–Ω–µ–Ω—ã) ---------- */

const topics = [
  /* ===== 1. TO BE ===== */
  {
    id:1,
    title:"To be (am / is / are)",
    level:"Beginner",
    explanation:
      "We use the verb to be to talk about who or what someone or something is, how they feel and where they are.",
    ruleRu:"<b>–ì–ª–∞–≥–æ–ª to be</b> = ¬´–±—ã—Ç—å, —è–≤–ª—è—Ç—å—Å—è, –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è¬ª.",
    usageRu:`
      <b>–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º:</b><br>
      1) –ö—Ç–æ —á–µ–ª–æ–≤–µ–∫: I am a student.<br>
      2) –°–æ—Å—Ç–æ—è–Ω–∏–µ: She is happy.<br>
      3) –ú–µ—Å—Ç–æ: They are at school.<br>
      <b>–§–æ—Ä–º—ã:</b> I am, You/We/They are, He/She/It is.<br>
      –û—Ç—Ä–∏—Ü–∞–Ω–∏–µ: am not / isn't / aren't. –í–æ–ø—Ä–æ—Å: Am/Is/Are + –ø–æ–¥–ª–µ–∂–∞—â–µ–µ?
    `,
    formulas:[
      "I am (I'm)",
      "You / We / They are",
      "He / She / It is"
    ],
    examples:[
      "I am a student.",
      "She is happy today.",
      "They are at school."
    ],
    exercises:[
      {
        title:"Ex.1 ‚Äì Positive sentences.",
        questions:[
          {text:"I ___ a beginner at English.", options:["am","is","are"], correct:0},
          {text:"She ___ my best friend.", options:["am","is","are"], correct:1},
          {text:"They ___ in the classroom.", options:["am","is","are"], correct:2},
          {text:"We ___ from Kazakhstan.", options:["am","is","are"], correct:2},
          {text:"He ___ twelve years old.", options:["am","is","are"], correct:1},
          {text:"It ___ Monday today.", options:["am","is","are"], correct:1},
          {text:"You ___ a good student.", options:["am","is","are"], correct:2}
        ]
      },
      {
        title:"Ex.2 ‚Äì Negative sentences.",
        questions:[
          {text:"I ___ tired. (not)", options:["am not","isn't","aren't"], correct:0},
          {text:"She ___ a teacher. (not)", options:["am not","isn't","aren't"], correct:1},
          {text:"They ___ in the library. (not)", options:["am not","isn't","aren't"], correct:2},
          {text:"We ___ late for the lesson. (not)", options:["am not","isn't","aren't"], correct:2},
          {text:"He ___ sixteen. (not)", options:["am not","isn't","aren't"], correct:1},
          {text:"It ___ cold today. (not)", options:["isn't","aren't","am not"], correct:0},
          {text:"You ___ from London. (not)", options:["aren't","isn't","am not"], correct:0}
        ]
      },
      {
        title:"Ex.3 ‚Äì Questions (Am / Is / Are).",
        questions:[
          {text:"___ you from Kazakhstan?", options:["Are","Is","Am"], correct:0},
          {text:"___ she your sister?", options:["Are","Is","Am"], correct:1},
          {text:"___ they at home?", options:["Are","Is","Am"], correct:0},
          {text:"___ it cold today?", options:["Are","Is","Am"], correct:1},
          {text:"___ we late?", options:["Are","Is","Am"], correct:0},
          {text:"___ I in Grade 7?", options:["Am","Is","Are"], correct:0},
          {text:"___ he your teacher?", options:["Is","Are","Am"], correct:0}
        ]
      },
      {
        title:"Ex.4 ‚Äì Sentence re-ordering (positive).",
        questions:[
          {text:"(a / I / student / am)", options:[
            "I am a student.",
            "Am student I a."
          ], correct:0},
          {text:"(is / she / happy / today)", options:[
            "She is happy today.",
            "Is happy she today."
          ], correct:0},
          {text:"(at school / they / are)", options:[
            "They are at school.",
            "Are they at school."
          ], correct:0},
          {text:"(from / we / Kazakhstan / are)", options:[
            "We are from Kazakhstan.",
            "Are from Kazakhstan we."
          ], correct:0},
          {text:"(is / my / teacher / kind)", options:[
            "My teacher is kind.",
            "Is kind my teacher."
          ], correct:0},
          {text:"(is / this / interesting / lesson)", options:[
            "This lesson is interesting.",
            "Lesson this interesting is."
          ], correct:0},
          {text:"(tired / am / not / I)", options:[
            "I am not tired.",
            "Am not I tired."
          ], correct:0}
        ]
      },
      {
        title:"Ex.5 ‚Äì Sentence re-ordering (negative).",
        questions:[
          {text:"(not / I / am / late)", options:[
            "I am not late.",
            "I not am late."
          ], correct:0},
          {text:"(isn't / happy / she / today)", options:[
            "She isn't happy today.",
            "Isn't she happy today."
          ], correct:0},
          {text:"(at school / aren't / they)", options:[
            "They aren't at school.",
            "Aren't they at school."
          ], correct:0},
          {text:"(from / we / aren't / London)", options:[
            "We aren't from London.",
            "Aren't we from London."
          ], correct:0},
          {text:"(cold / it / isn't / today)", options:[
            "It isn't cold today.",
            "Isn't it cold today."
          ], correct:0},
          {text:"(am / not / I / tired)", options:[
            "I am not tired.",
            "Am I not tired."
          ], correct:0},
          {text:"(isn't / my / teacher / sad)", options:[
            "My teacher isn't sad.",
            "Isn't my teacher sad."
          ], correct:0}
        ]
      },
      {
        title:"Ex.6 ‚Äì Sentence re-ordering (questions).",
        questions:[
          {text:"(you / are / from / Aktau)", options:[
            "Are you from Aktau?",
            "You are from Aktau?"
          ], correct:0},
          {text:"(your / is / she / sister)", options:[
            "Is she your sister?",
            "She is your sister?"
          ], correct:0},
          {text:"(at home / are / they)", options:[
            "Are they at home?",
            "They are at home?"
          ], correct:0},
          {text:"(late / are / we)", options:[
            "Are we late?",
            "We are late?"
          ], correct:0},
          {text:"(your teacher / he / is)", options:[
            "Is he your teacher?",
            "He is your teacher?"
          ], correct:0},
          {text:"(cold / is / it / today)", options:[
            "Is it cold today?",
            "It is cold today?"
          ], correct:0},
          {text:"(in Grade 7 / you / are)", options:[
            "Are you in Grade 7?",
            "You are in Grade 7?"
          ], correct:0}
        ]
      },
      {
        title:"Ex.7 ‚Äì Mixed practice.",
        questions:[
          {text:"My teacher ___ very kind.", options:["is","are","am"], correct:0},
          {text:"Our school ___ big and modern.", options:["is","are","am"], correct:0},
          {text:"The students ___ in the gym now.", options:["is","are","am"], correct:1},
          {text:"My friends and I ___ online.", options:["are","is","am"], correct:0},
          {text:"This lesson ___ interesting.", options:["is","are","am"], correct:0},
          {text:"I ___ not tired.", options:["am","is","are"], correct:0},
          {text:"___ they from Kazakhstan?", options:["Are","Is","Am"], correct:0}
        ]
      }
    ]
  },
    /* ===== 2. PLURALS ===== */
  {
    id:2,
    title:"Plurals",
    level:"Beginner",
    explanation:"Regular plurals usually add -s or -es. Some words change y ‚Üí ies or have irregular forms.",
    ruleRu:"<b>–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö</b>.",
    usageRu:`
      <b>–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º:</b> –∫–æ–≥–¥–∞ –≥–æ–≤–æ—Ä–∏–º –Ω–µ –æ–± –æ–¥–Ω–æ–º, –∞ –æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–∞—Ö.<br>
      ‚Ä¢ –æ–±—ã—á–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º <b>-s</b>: book ‚Üí books, cat ‚Üí cats<br>
      ‚Ä¢ –ø–æ—Å–ª–µ -s, -sh, -ch, -x, -z –¥–æ–±–∞–≤–ª—è–µ–º <b>-es</b>: bus ‚Üí buses, box ‚Üí boxes<br>
      ‚Ä¢ –µ—Å–ª–∏ —Å–ª–æ–≤–æ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–æ–≥–ª–∞—Å–Ω–∞—è + y: y ‚Üí ies: baby ‚Üí babies<br>
      ‚Ä¢ –µ—Å—Ç—å –Ω–µ—Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ñ–æ—Ä–º—ã: child ‚Üí children, man ‚Üí men, woman ‚Üí women, tooth ‚Üí teeth.
    `,
    formulas:["book ‚Üí books","bus ‚Üí buses","baby ‚Üí babies","child ‚Üí children"],
    examples:[
      "I have three books.",
      "There are two boxes on the table.",
      "Those children are in the yard."
    ],
    exercises:[
      {
        title:"Ex.1 ‚Äì Add -s.",
        questions:[
          {text:"one book ‚Äì two ___", options:["books","bookes","book"], correct:0},
          {text:"one pen ‚Äì three ___", options:["pens","pen","penses"], correct:0},
          {text:"one dog ‚Äì four ___", options:["dogs","doges","dog"], correct:0},
          {text:"one car ‚Äì many ___", options:["cars","cares","car"], correct:0},
          {text:"one friend ‚Äì two ___", options:["friends","friendes","friend"], correct:0}
        ]
      },
      {
        title:"Ex.2 ‚Äì Add -es.",
        questions:[
          {text:"one bus ‚Äì two ___", options:["buses","buss","bus"], correct:0},
          {text:"one box ‚Äì three ___", options:["boxes","boxs","boxies"], correct:0},
          {text:"one watch ‚Äì five ___", options:["watches","watchs","watchies"], correct:0},
          {text:"one dish ‚Äì many ___", options:["dishes","dishs","dishies"], correct:0},
          {text:"one class ‚Äì four ___", options:["classes","classs","class"], correct:0}
        ]
      }
    ]
  },

  /* ===== 3. ARTICLES ===== */
  {
    id:3,
    title:"Articles (a / an / the)",
    level:"Beginner",
    explanation:"We use a/an with singular countable nouns, the when the listener knows which thing we mean, and no article (‚àÖ) for general ideas or plurals.",
    ruleRu:"<b>–ê—Ä—Ç–∏–∫–ª–∏ a / an / the</b> —Å—Ç–∞–≤—è—Ç—Å—è –ø–µ—Ä–µ–¥ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏.",
    usageRu:`
      <b>a</b> ‚Äì –ø–µ—Ä–µ–¥ —Å–ª–æ–≤–æ–º, –Ω–∞—á–∏–Ω–∞—é—â–∏–º—Å—è —Å —Å–æ–≥–ª–∞—Å–Ω–æ–≥–æ –∑–≤—É–∫–∞: a bag, a pen.<br>
      <b>an</b> ‚Äì –ø–µ—Ä–µ–¥ –≥–ª–∞—Å–Ω—ã–º –∑–≤—É–∫–æ–º: an apple, an orange.<br>
      <b>the</b> ‚Äì –∫–æ–≥–¥–∞ –ø—Ä–µ–¥–º–µ—Ç —É–∂–µ –∏–∑–≤–µ—Å—Ç–µ–Ω, —É–Ω–∏–∫–∞–ª–µ–Ω –∏–ª–∏ –º—ã —É—Ç–æ—á–Ω—è–µ–º: the sun, the teacher.<br>
      <b>–ë–µ–∑ –∞—Ä—Ç–∏–∫–ª—è (‚àÖ)</b> ‚Äì –ø–µ—Ä–µ–¥ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏ –≤–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —á–∏—Å–ª–µ –∏ –Ω–µ–∏—Å—á–∏—Å–ª—è–µ–º—ã–º–∏, –∫–æ–≥–¥–∞ –≥–æ–≤–æ—Ä–∏–º –≤–æ–æ–±—â–µ: I like apples. Milk is healthy.
    `,
    formulas:[
      "a + consonant sound: a cat",
      "an + vowel sound: an apple",
      "the + specific thing",
      "‚àÖ + plural / uncountable"
    ],
    examples:[
      "This is a cat. The cat is black.",
      "I have an orange.",
      "She likes milk. Milk is cold."
    ],
    exercises:[
      {
        title:"Ex.1 ‚Äì Choose a or an.",
        questions:[
          {text:"___ apple", options:["a","an","the"], correct:1},
          {text:"___ orange", options:["a","an","the"], correct:1},
          {text:"___ bag", options:["a","an","the"], correct:0},
          {text:"___ egg", options:["a","an","the"], correct:1},
          {text:"___ umbrella", options:["a","an","the"], correct:1}
        ]
      }
    ]
  },

  /* ===== 4. PRESENT SIMPLE (–∫–æ—Ä–æ—Ç–∫–æ) ===== */
  {
    id:4,
    title:"Present Simple",
    level:"Beginner",
    explanation:"We use Present Simple to talk about routines, habits, facts and permanent situations.",
    ruleRu:"<b>Present Simple</b> ‚Äî –≤—Ä–µ–º—è –¥–ª—è –ø—Ä–∏–≤—ã—á–µ–∫, —Ä–∞—Å–ø–æ—Ä—è–¥–∫–∞, —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π, —Ñ–∞–∫—Ç–æ–≤.",
    usageRu:`
      <b>–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º:</b><br>
      1) –ü—Ä–∏–≤—ã—á–∫–∏: I get up at 7.<br>
      2) –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: School starts at 8:00.<br>
      3) –§–∞–∫—Ç—ã: Water boils at 100¬∞C.<br>
      he/she/it + V-s, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –±–µ–∑ -s.
    `,
    formulas:["I play","He plays","Do you play?","She doesn‚Äôt play"],
    examples:["I go to school every day.","She likes English.","We don't watch TV at night."],
    exercises:[
      {
        title:"Ex.1 ‚Äì Choose the correct verb form.",
        questions:[
          {text:"I ___ to school every day.", options:["go","goes"], correct:0},
          {text:"She ___ breakfast at 7.", options:["has","have"], correct:0},
          {text:"They ___ in Aktau.", options:["live","lives"], correct:0},
          {text:"He ___ football on Sundays.", options:["plays","play"], correct:0},
          {text:"My sister ___ very hard.", options:["studies","study"], correct:0}
        ]
      }
    ]
  },

  /* ===== 5. CAN / CAN'T ===== */
  {
    id:5,
    title:"Can / can't",
    level:"Beginner",
    explanation:"We use can to talk about ability and possibility. We use can't to say that something is not possible.",
    ruleRu:"<b>Can / can't</b> ‚Äì —É–º–µ—Ç—å, –º–æ—á—å.",
    usageRu:`
      <b>–£—Ç–≤–µ—Ä–¥–∏—Ç–µ–ª—å–Ω—ã–µ:</b> S + can + V ‚Äì I can swim.<br>
      <b>–û—Ç—Ä–∏—Ü–∞–Ω–∏–µ:</b> S + can't + V ‚Äì She can't drive.<br>
      <b>–í–æ–ø—Ä–æ—Å:</b> Can + S + V? ‚Äì Can you help me?
    `,
    formulas:[
      "I can swim.",
      "She can speak English.",
      "He can't sing.",
      "Can they help you?"
    ],
    examples:[
      "I can play the guitar.",
      "They can't speak French.",
      "Can you ride a bike?"
    ],
    exercises:[
      {
        title:"Ex.1 ‚Äì can / can't.",
        questions:[
          {text:"I ___ ride a bike.", options:["can","can't"], correct:0},
          {text:"She ___ swim very well.", options:["can","can't"], correct:0},
          {text:"They ___ speak Chinese.", options:["can","can't"], correct:1},
          {text:"My little brother ___ read.", options:["can","can't"], correct:1},
          {text:"We ___ play football after school.", options:["can","can't"], correct:0}
        ]
      }
    ]
  },

  /* ===== 6. THERE IS / THERE ARE ===== */
  {
    id:6,
    title:"There is / There are",
    level:"Beginner",
    explanation:"We use there is / there are to say that something exists in a place.",
    ruleRu:"<b>There is / There are</b> ‚Äì ¬´–µ—Å—Ç—å, –∏–º–µ–µ—Ç—Å—è¬ª.",
    usageRu:`
      <b>There is</b> + –µ–¥.—á. / –Ω–µ–∏—Å—á–∏—Å–ª.: There is a book on the table.<br>
      <b>There are</b> + –º–Ω.—á.: There are three books on the table.<br>
      –û—Ç—Ä–∏—Ü–∞–Ω–∏–µ: There isn't / There aren't.<br>
      –í–æ–ø—Ä–æ—Å: Is there...? / Are there...?
    `,
    formulas:[
      "There is a cat in the room.",
      "There are two chairs in the kitchen.",
      "Is there a park near here?",
      "There aren't any apples."
    ],
    examples:[
      "There is a big window in my room.",
      "There are many students in the classroom.",
      "Is there a bank near your house?"
    ],
    exercises:[
      {
        title:"Ex.1 ‚Äì there is / there are.",
        questions:[
          {text:"___ a book on the table.", options:["There is","There are"], correct:0},
          {text:"___ two cats in the garden.", options:["There is","There are"], correct:1},
          {text:"___ a teacher in the classroom.", options:["There is","There are"], correct:0},
          {text:"___ three windows in my room.", options:["There is","There are"], correct:1},
          {text:"___ some milk in the fridge.", options:["There is","There are"], correct:0}
        ]
      }
    ]
  },

  /* ===== 7. PRONOUNS & POSSESSIVE ADJECTIVES ===== */
  {
    id:7,
    title:"Pronouns & Possessive Adjectives (my / your / his / her / our / their)",
    level:"Beginner",
    explanation:"Possessive adjectives show who something belongs to. They always go before a noun.",
    ruleRu:`<b>–ü—Ä–∏—Ç—è–∂–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ</b> –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, –∫–æ–º—É —á—Ç–æ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç.<br>
      –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è <b>—Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º</b>: my book, her name, their school.<br>
      <b>my ‚Äì –º–æ–π, your ‚Äì —Ç–≤–æ–π/–≤–∞—à, his ‚Äì –µ–≥–æ, her ‚Äì –µ—ë, its ‚Äì –µ–≥–æ (–ø—Ä–µ–¥–º–µ—Ç–∞/–∂–∏–≤–æ—Ç–Ω–æ–≥–æ), our ‚Äì –Ω–∞—à, their ‚Äì –∏—Ö</b>.`,
    usageRu:`
      –ò—Å–ø–æ–ª—å–∑—É–µ–º, –∫–æ–≥–¥–∞ –≥–æ–≤–æ—Ä–∏–º <b>—á–µ–π –ø—Ä–µ–¥–º–µ—Ç</b> –∏–ª–∏ <b>—á–µ–π —á–µ–ª–æ–≤–µ–∫</b>:<br>
      ‚Ä¢ This is <b>my</b> bag. ‚Äì –≠—Ç–æ –º–æ—è —Å—É–º–∫–∞.<br>
      ‚Ä¢ That is <b>his</b> sister. ‚Äì –≠—Ç–æ –µ–≥–æ —Å–µ—Å—Ç—Ä–∞.<br>
      ‚Ä¢ These are <b>their</b> books. ‚Äì –≠—Ç–æ –∏—Ö –∫–Ω–∏–≥–∏.
    `,
    formulas:[
      "my / your / his / her / its / our / their + noun"
    ],
    examples:[
      "This is my school.",
      "His name is Arman.",
      "Their house is big."
    ],
    exercises:[
      {
        title:"Ex.1 ‚Äì Choose the correct option.",
        questions:[
          {text:"This is ___ book.", options:["my","his","their"], correct:0},
          {text:"That is ___ sister.", options:["her","their","its"], correct:0},
          {text:"These are ___ bags.", options:["our","my","its"], correct:0},
          {text:"He loves ___ dog.", options:["your","her","his"], correct:2},
          {text:"They‚Äôre in ___ classroom.", options:["their","its","my"], correct:0}
        ]
      },
      {
        title:"Ex.2 ‚Äì Fill in (choose).",
        questions:[
          {text:"Aika and I live with ___ parents.", options:["our","their","his"], correct:0},
          {text:"Aruzhan is talking to ___ friend Dana.", options:["my","her","their"], correct:1},
          {text:"The dog is eating ___ food.", options:["its","his","their"], correct:0},
          {text:"This is ___ new backpack.", options:["my","your","her"], correct:2},
          {text:"Is this ___ phone?", options:["your","its","our"], correct:0}
        ]
      }
    ]
  },

  /* ===== 8‚Äì20: –∑–∞–≥–ª—É—à–∫–∏, —á—Ç–æ–±—ã –∫–æ–¥ –±—ã–ª —Ü–µ–ª—å–Ω—ã–π ===== */
  ...Array.from({length:13},(_,i)=>({
    id:8+i,
    title:`Topic ${8+i} ‚Äì coming soon`,
    level:"Beginner",
    explanation:"This topic will be added later.",
    ruleRu:"–ü—Ä–∞–≤–∏–ª–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–∑–∂–µ.",
    usageRu:"",
    formulas:[],
    examples:[],
    exercises:[]
  }))
];
/* ---------- STATE & STORAGE ---------- */

let currentUser = null; // {name, code, classLabel, stars, lastLogin}
let currentTopicId = null;

function todayStr(){
  return new Date().toISOString().slice(0,10);
}
function studentKey(code){
  return "bayan_student_"+code;
}

function loadStudent(code,name,classLabel){
  const key = studentKey(code);
  let data = null;
  try{
    data = JSON.parse(localStorage.getItem(key));
  }catch(e){
    data=null;
  }
  if(!data){
    data = {
      name:name||"",
      code,
      classLabel,
      stars:0,
      lastLogin:null
    };
  }else{
    if(name) data.name = name;
    data.classLabel = classLabel;
  }
  data.lastLogin = todayStr();
  localStorage.setItem(key,JSON.stringify(data));
  return data;
}
function saveCurrent(){
  if(!currentUser) return;
  const key = studentKey(currentUser.code);
  localStorage.setItem(key,JSON.stringify(currentUser));
}

/* ---------- SCREEN SWITCHING ---------- */

function showOnly(id){
  document.getElementById("loginScreen").classList.add("hidden");
  document.getElementById("mainMenuScreen").classList.add("hidden");
  document.getElementById("topicScreen").classList.add("hidden");
  document.getElementById("teacherScreen").classList.add("hidden");
  document.getElementById(id).classList.remove("hidden");
}
function setTopInfo(html){
  document.getElementById("topInfo").innerHTML = html;
}

/* ---------- LOGIN ---------- */

function handleLogin(){
  const name = document.getElementById("loginName").value.trim();
  const codeStr = document.getElementById("loginCode").value.trim();
  const errorEl = document.getElementById("loginError");
  errorEl.classList.add("hidden");
  errorEl.textContent = "";

  if(!codeStr){
    errorEl.textContent = "Enter your code.";
    errorEl.classList.remove("hidden");
    return;
  }

  if(codeStr==="3234"){
    setTopInfo(`Logged in as <strong>TEACHER</strong> ¬∑ code 3234`);
    renderTeacherTable();
    showOnly("teacherScreen");
    return;
  }

  const num = Number(codeStr);
  if(!Number.isInteger(num)){
    errorEl.textContent = "Code must be a number.";
    errorEl.classList.remove("hidden");
    return;
  }
  const classLabel = getClassByCode(num);
  if(!classLabel){
    errorEl.textContent = "Unknown student code. Ask your teacher.";
    errorEl.classList.remove("hidden");
    return;
  }
  if(!name){
    errorEl.textContent = "Enter your name.";
    errorEl.classList.remove("hidden");
    return;
  }

  currentUser = loadStudent(num,name,classLabel);
  saveCurrent();
  setTopInfo(
    `Class <strong>${currentUser.classLabel}</strong> ¬∑ Student: <strong>${currentUser.name}</strong> (code ${currentUser.code}) ¬∑ Stars: <strong id="topStars">${currentUser.stars}</strong>`
  );
  buildMainMenu();
  updateTopStars();
  showOnly("mainMenuScreen");
}

function backToLogin(){
  currentUser = null;
  setTopInfo("Not logged in");
  document.getElementById("loginCode").value = "";
  document.getElementById("loginName").value = "";
  showOnly("loginScreen");
}

/* ---------- MAIN MENU UI ---------- */

function buildMainMenu(){
  if(!currentUser) return;
  document.getElementById("menuInfo").innerHTML =
    `Class <strong>${currentUser.classLabel}</strong>, student <strong>${currentUser.name}</strong> (code ${currentUser.code})`;
  document.getElementById("menuStars").textContent = currentUser.stars ?? 0;

  const grid = document.getElementById("menuTopics");
  grid.innerHTML = "";
  topics.forEach(t=>{
    const div = document.createElement("div");
    div.className = "topic-card";
    const color = topicColors[t.id] || "#005b73";
    div.style.borderColor = color+"55";
    div.style.background = "#f8fafc";
    div.innerHTML = `
      <div class="topic-card-title">${t.id}. ${t.title}</div>
      <div class="topic-card-sub">${t.level}</div>
    `;
    div.addEventListener("click",()=>openTopic(t.id));
    grid.appendChild(div);
  });

  // –ø—Ä–æ—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ DEMO AI
  const chat = document.getElementById("chatBox");
  chat.innerHTML = "";
  const msg = document.createElement("div");
  msg.className = "chat-msg";
  msg.textContent = "AI Bayan chat will be available later. Now use topics and exercises.";
  chat.appendChild(msg);
  document.getElementById("aiLimit").textContent = "¬∑ demo mode";
}

/* ---------- TOPIC SCREEN ---------- */

function openTopic(id){
  currentTopicId = id;
  const t = topics.find(x=>x.id===id);
  if(!t) return;

  const color = topicColors[id] || "#005b73";
  document.documentElement.style.setProperty("--topicColor",color);

  document.getElementById("topicHeaderTitle").textContent = `${id}. ${t.title}`;
  document.getElementById("topicHeaderTag").innerHTML =
    `<span class="tag">${t.level}</span>`;

  const rc = document.getElementById("topicRuleContainer");
  rc.innerHTML = "";
  const gbox = document.createElement("div");
  gbox.className = "grammar-box";
  gbox.innerHTML = `
    <strong>Rule (EN):</strong> ${t.explanation || ""}
    ${
      t.formulas && t.formulas.length
        ? "<div style='margin-top:6px;'>"+
          t.formulas.map(f=>`<span class="formula">${f}</span>`).join(" ")+
          "</div>"
        : ""
    }
    ${
      t.ruleRu || t.usageRu
        ? `<div class="grammar-ru">
             <strong>–ü—Ä–∞–≤–∏–ª–æ (RU):</strong><br>
             ${t.ruleRu||""}<br>${t.usageRu||""}
           </div>`
        : ""
    }
  `;
  rc.appendChild(gbox);

  if(t.examples && t.examples.length){
    const ul = document.createElement("ul");
    ul.className = "examples";
    t.examples.forEach(e=>{
      const li = document.createElement("li");
      li.textContent = e;
      ul.appendChild(li);
    });
    rc.appendChild(ul);
  }

  const ec = document.getElementById("topicExercisesContainer");
  ec.innerHTML = "";
  if(!t.exercises || t.exercises.length===0){
    const p = document.createElement("p");
    p.className = "muted";
    p.style.marginTop = "10px";
    p.textContent = "Exercises for this topic will be added later.";
    ec.appendChild(p);
  }else{
    const wrapper = document.createElement("div");
    wrapper.className = "exercises";
    t.exercises.forEach((ex,exIndex)=>{
      const block = document.createElement("div");
      block.className = "exercise-block";
      const title = document.createElement("div");
      title.className = "exercise-title";
      title.innerHTML = ex.title;
      block.appendChild(title);

      ex.questions.forEach((q,qIndex)=>{
        const row = document.createElement("div");
        row.className = "question-row";
        const qText = document.createElement("div");
        qText.className = "question-text";
        qText.textContent = `${qIndex+1}) ${q.text}`;
        row.appendChild(qText);

        const opts = document.createElement("div");
        opts.className = "options";
        q.options.forEach((opt,optIndex)=>{
          const label = document.createElement("label");
          const radio = document.createElement("input");
          radio.type = "radio";
          const gname = `t${id}_e${exIndex}_q${qIndex}`;
          radio.name = gname;
          radio.value = optIndex;
          label.appendChild(radio);
          label.appendChild(document.createTextNode(" "+opt));
          opts.appendChild(label);
        });
        row.appendChild(opts);

        const mark = document.createElement("span");
        mark.className = "mark";
        mark.id = `mark_t${id}_e${exIndex}_q${qIndex}`;
        row.appendChild(mark);

        block.appendChild(row);
      });

      const footer = document.createElement("div");
      footer.className = "exercise-footer";
      const small = document.createElement("small");
      small.textContent = "Each correct answer gives you 1 star.";
      const btn = document.createElement("button");
      btn.className = "btn btn-primary";
      btn.textContent = "Check";
      btn.addEventListener("click",()=>checkExercise(id,exIndex));
      footer.appendChild(small);
      footer.appendChild(btn);
      block.appendChild(footer);

      wrapper.appendChild(block);
    });
    ec.appendChild(wrapper);
  }

  showOnly("topicScreen");
}

function backToMenu(){
  if(!currentUser){
    backToLogin();
    return;
  }
  buildMainMenu();
  showOnly("mainMenuScreen");
}

function printCurrentTopic(){
  if(!currentTopicId){
    alert("Open a topic first.");
    return;
  }
  window.print();
}

function updateTopStars(){
  const el = document.getElementById("topStars");
  const ms = document.getElementById("menuStars");
  if(currentUser){
    const s = currentUser.stars ?? 0;
    if(el) el.textContent = s;
    if(ms) ms.textContent = s;
  }
}

function checkExercise(topicId,exIndex){
  if(!currentUser) return;
  const t = topics.find(x=>x.id===topicId);
  if(!t) return;
  const ex = t.exercises[exIndex];
  if(!ex) return;

  let gained = 0;
  ex.questions.forEach((q,qIndex)=>{
    const gname = `t${topicId}_e${exIndex}_q${qIndex}`;
    const selected = document.querySelector(`input[name="${gname}"]:checked`);
    const markEl = document.getElementById(`mark_t${topicId}_e${exIndex}_q${qIndex}`);
    if(!markEl) return;
    markEl.textContent = "";
    markEl.classList.remove("correct","wrong");

    if(!selected){
      markEl.textContent = "‚Ä¢";
      return;
    }
    const chosen = Number(selected.value);
    if(chosen===q.correct){
      markEl.textContent="‚úì";
      markEl.classList.add("correct");
      gained++;
    }else{
      markEl.textContent="‚úó";
      markEl.classList.add("wrong");
    }
  });

  if(gained>0){
    currentUser.stars += gained;
    saveCurrent();
    updateTopStars();
    alert(`Well done! You gained ${gained} star(s).`);
  }else{
    alert("No correct answers yet. Try again!");
  }
}

/* ---------- TEACHER TABLE ---------- */

function renderTeacherTable(){
  const tbody = document.querySelector("#teacherTable tbody");
  tbody.innerHTML = "";
  const allStudents = [];
  classRanges.forEach(r=>{
    for(let code=r.from; code<=r.to; code++){
      const key = studentKey(code);
      let data = null;
      try{
        data = JSON.parse(localStorage.getItem(key));
      }catch(e){ data=null; }
      if(data) allStudents.push(data);
    }
  });
  if(allStudents.length===0){
    const tr = document.createElement("tr");
    const td = document.createElement("td");
    td.colSpan = 5;
    td.textContent =
      "No student data in this browser yet. Ask students to log in and work with tasks.";
    tr.appendChild(td);
    tbody.appendChild(tr);
    return;
  }
  allStudents.sort((a,b)=>a.code-b.code);
  allStudents.forEach(s=>{
    const tr = document.createElement("tr");
    const cls = document.createElement("td");
    cls.textContent = s.classLabel || getClassByCode(s.code) || "";
    const codeTd = document.createElement("td");
    codeTd.textContent = s.code;
    const nameTd = document.createElement("td");
    nameTd.textContent = s.name || "";
    const starsTd = document.createElement("td");
    starsTd.textContent = s.stars ?? 0;
    const loginTd = document.createElement("td");
    loginTd.textContent = s.lastLogin || "";
    tr.appendChild(cls);
    tr.appendChild(codeTd);
    tr.appendChild(nameTd);
    tr.appendChild(starsTd);
    tr.appendChild(loginTd);
    tbody.appendChild(tr);
  });
}

/* ---------- INIT ---------- */

showOnly("loginScreen");
</script>
</body>
</html>
